version: 1
frontend:
  phases:
    preBuild:
      commands:
        - cd services/frontend
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: services/frontend/dist
    files:
      - "**/*"
  cache:
    paths:
      - services/frontend/node_modules/**/*
  # SPA rewrite: send all non-file requests to index.html so React Router handles routing.
  # Without this, any direct navigation or OAuth callback to a sub-path returns 404.
  redirects:
    - source: "/<*>"
      target: /index.html
      status: "404-200"
customHeaders:
  - pattern: "**/*"
    headers:
      - key: "Strict-Transport-Security"
        value: "max-age=31536000; includeSubDomains"
      - key: "X-Frame-Options"
        value: "SAMEORIGIN"
      - key: "X-Content-Type-Options"
        value: "nosniff"
